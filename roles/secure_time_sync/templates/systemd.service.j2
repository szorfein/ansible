[Unit]
Description=Network Time Synchronization
ConditionCapability=CAP_SYS_TIME
Conflicts=shutdown.target
DefaultDependencies=no
After=network-online.target nss-lookup.target
Wants=network-online.target time-set.target

[Service]
Type=oneshot
AmbientCapabilities=CAP_SYS_TIME
CapabilityBoundingSet=CAP_SYS_TIME
ExecStartPre=sh -c 'while ! getent hosts eff.org; do sleep 1; done'
ExecStart=!!/usr/local/bin/secure-time-sync
ProtectProc=invisible
ProtectControlGroups=yes
ProtectHome=yes
ProtectHostname=yes
ProtectKernelLogs=yes
ProtectKernelModules=yes
ProtectKernelTunables=yes
ProtectSystem=strict

[Install]
WantedBy=network-online.target
